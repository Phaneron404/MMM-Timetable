/*! *****************************************************************************
  mmm-timetable
  Version 1.0.0

  A Timetable to show subjects in school for the MagicMirrorÂ² platform.
  Please submit bugs at https://github.com/Phaneron404/MMM-Timetable/issues

  (c) Phaneron404
  Licence: MIT

  This file is auto-generated. Do not edit.
***************************************************************************** */

!function(){"use strict";class t{static getCellType(t,i,e){let s="contentCell";return this.isEmptyTexts(t.texts)?s="emptyCell":i.forEach(((i,l)=>{i.cells.forEach(((i,a)=>{t.id===i.id&&(void 0!==e.titleRow&&e.titleRow.includes(l)||void 0!==e.titleColumn&&e.titleColumn.includes(a))&&(s="titleCell")}))})),s}static isEmptyTexts(t){let i=!0;return t.forEach((t=>{""!==t.trim()&&(i=!1)})),i}}Module.register("MMM-Timetable",{displayedTimeTable:[],lastIndex:-1,activeMqttId:"",defaults:{srcCSV:"",timeTable:[],mqttTimeTables:[],borderWidth:5,borderColor:"rgb(0, 0, 0)",cellColor:"#1E1E20",titleCellColor:"#B7410E",emptyCellColor:"rgba(0, 0, 0, 0)",titleRow:[0],titleColumn:[0],mqttBrokerUrl:"",mqttOptions:{},mqttTopic:""},start(){this._setupMqtt(),this.setDisplayedTimeTable(),this.prepareTable(),this.schedulePaginationUpdate(),this.loadCSV(),this.scheduleReloadCSV()},_setupMqtt(){this.config.mqttBrokerUrl&&this.config.mqttTopic&&this.sendSocketNotification("CONNECT_MQTT",{brokerUrl:this.config.mqttBrokerUrl,options:this.config.mqttOptions,topic:this.config.mqttTopic})},setDisplayedTimeTable(){var t;this.displayedTimeTable=[],void 0!==this.config.pagination?"column"==this.config.pagination.mode&&(this.config.timeTable.forEach((t=>{const i={cells:[]};let e=0;t.cells.forEach(((t,s)=>{let l=!1;this.config.pagination.keepFirst&&0==s&&(i.cells.push(t),l=!0,e++),e<this.config.pagination.maxValues&&s>this.lastIndex&&!l&&(i.cells.push(t),e++)})),this.displayedTimeTable.push(i)})),this.lastIndex=this.lastIndex+this.config.pagination.maxValues,this.lastIndex>=this.config.timeTable[0].cells.length-1&&(this.lastIndex=-1)):this.config.mqttTimeTables&&this.activeMqttId&&""!==this.activeMqttId?this.displayedTimeTable=null===(t=this.config.mqttTimeTables.find((t=>t.mqttId===this.activeMqttId)))||void 0===t?void 0:t.timeTable:this.displayedTimeTable=this.config.timeTable},prepareTable(){let t=0;this.displayedTimeTable.forEach((i=>{i.cells.forEach((i=>{i.id=t++}))}))},getTemplate:()=>"templates/timetable.njk",getTemplateData(){return{config:this.config,timeTable:this.displayedTimeTable,utils:t}},schedulePaginationUpdate(){void 0!==this.config.pagination&&setInterval((()=>{this.updateTimeTable()}),1e3*this.config.pagination.duration)},scheduleReloadCSV(){void 0!==this.config.reloadAt&&setInterval((()=>{const t=new Date;t.getHours()==this.config.reloadAt.hour&&t.getMinutes()==this.config.reloadAt.minute&&this.loadCSV()}),6e4)},loadCSV(){""!==this.config.srcCSV&&void 0!==this.config.srcCSV&&this.sendSocketNotification("READ_CSV",{filePath:this.config.srcCSV})},updateTimeTable(){this.setDisplayedTimeTable(),this.prepareTable(),this.updateDom()},socketNotificationReceived:function(t,i){"CSV_DATA"===t?(this.config.timeTable=i,this.updateTimeTable()):"MQTT_DATA"===t&&(this.activeMqttId=i,this.updateTimeTable())}})}();
