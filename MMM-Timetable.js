/*! *****************************************************************************
  mmm-timetable
  Version 1.0.0

  A Timetable to show subjects in school for the MagicMirrorÂ² platform.
  Please submit bugs at https://github.com/Phaneron404/MMM-Timetable/issues

  (c) Phaneron404
  Licence: MIT

  This file is auto-generated. Do not edit.
***************************************************************************** */

!function(){"use strict";class t{static getCellType(t,e,i){let s="contentCell";return this.isEmptyTexts(t.texts)?s="emptyCell":e.forEach(((e,l)=>{e.cells.forEach(((e,a)=>{t.id===e.id&&(void 0!==i.titleRow&&i.titleRow.includes(l)||void 0!==i.titleColumn&&i.titleColumn.includes(a))&&(s="titleCell")}))})),s}static isEmptyTexts(t){let e=!0;return t.forEach((t=>{""!==t.trim()&&(e=!1)})),e}}Module.register("MMM-Timetable",{displayedTimeTable:[],lastIndex:-1,activeMqttId:"",defaults:{srcCSV:"",timeTable:[],mqttTimeTables:[],borderWidth:5,borderColor:"rgb(0, 0, 0)",cellColor:"#1E1E20",titleCellColor:"#B7410E",emptyCellColor:"rgba(0, 0, 0, 0)",titleRow:[0],titleColumn:[0],mqttBrokerUrl:"",mqttOptions:{},mqttTopic:""},start(){this._setupMqtt(),this.setDisplayedTimeTable(),this.prepareTable()},_setupMqtt(){this.config.mqttBrokerUrl&&this.config.mqttTopic&&this.sendSocketNotification("CONNECT_MQTT",{brokerUrl:this.config.mqttBrokerUrl,options:this.config.mqttOptions,topic:this.config.mqttTopic})},setDisplayedTimeTable(){if(this.displayedTimeTable=[],void 0!==this.config.pagination)"column"==this.config.pagination.mode&&(this.config.timeTable.forEach((t=>{const e={cells:[]};let i=0;t.cells.forEach(((t,s)=>{let l=!1;this.config.pagination.keepFirst&&0==s&&(e.cells.push(t),l=!0,i++),i<this.config.pagination.maxValues&&s>this.lastIndex&&!l&&(e.cells.push(t),i++)})),this.displayedTimeTable.push(e)})),this.lastIndex=this.lastIndex+this.config.pagination.maxValues,this.lastIndex>=this.config.timeTable[0].cells.length-1&&(this.lastIndex=-1));else if(this.config.mqttTimeTables&&this.activeMqttId&&""!==this.activeMqttId){const t=this.config.mqttTimeTables.find((t=>t.mqttId===this.activeMqttId));t&&(t.timeTable&&(this.displayedTimeTable=t.timeTable),t.csvName&&this.sendSocketNotification("READ_CSV",{filePath:t.csvName}))}else this.displayedTimeTable=this.config.timeTable},prepareTable(){let t=0;this.displayedTimeTable.forEach((e=>{e.cells.forEach((e=>{e.id=t++}))}))},getTemplate:()=>"templates/timetable.njk",getTemplateData(){return{config:this.config,timeTable:this.displayedTimeTable,utils:t}},schedulePaginationUpdate(){void 0!==this.config.pagination&&setInterval((()=>{this.updateTimeTable()}),1e3*this.config.pagination.duration)},scheduleReloadCSV(){void 0!==this.config.reloadAt&&setInterval((()=>{const t=new Date;t.getHours()==this.config.reloadAt.hour&&t.getMinutes()==this.config.reloadAt.minute&&this.loadCSV()}),6e4)},loadCSV(){""!==this.config.srcCSV&&void 0!==this.config.srcCSV&&this.sendSocketNotification("READ_CSV",{filePath:this.config.srcCSV})},updateTimeTable(){this.setDisplayedTimeTable(),this.prepareTable(),this.updateDom()},socketNotificationReceived:function(t,e){"CSV_DATA"===t?this.displayedTimeTable=e:"MQTT_DATA"===t&&(this.activeMqttId=e,this.updateTimeTable())}})}();
